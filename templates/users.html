{% extends "base.html" %}
{% block content %}
{% if session['logged_in'] %}
<link rel="stylesheet" href="{{ url_for('static', filename='users.css') }}">
<div id="user_list">
   
</div>
<script type="text/javascript" charset="utf-8">
    var socket = io();
    socket.on('connect', function(response) {
        socket.emit('init', "{{session['username']}}");
    });
    socket.on('User Init', function(data){
        users = JSON.parse(data);
        clearUserList();
        // userlist = document.getElementById('user_list')
        for (let i in users){
            user = users[i];
            addUserItem(user)
        }
    });
    socket.on('User Update', function(data){
        users = JSON.parse(data);
        clearUserList();
        for (let i in users){
            user = users[i];
            // div = document.createElement('div');
            // div.innerText = user;
            // userlist.appendChild(div)
            addUserItem(user)
        }
    });

    function clearUserList(){
        userlist = document.getElementById('user_list')
        userlist.innerHTML = "";
    }

    function delUser(username){
        console.log('deleting ' + username)
        socket.emit('delete', username)
    }

    function addUserItem(username){
        userlist = document.getElementById('user_list');
        label = document.createElement('span');
        divider = document.createElement('span');
        label.innerText = username;
        divider.innerText = " | ";
        deletebutton = document.createElement('button');
        deletebutton.innerText = "Delete";
        deletebutton.setAttribute('username', username);
        deletebutton.addEventListener('click', function(e){
            if (confirm("Are you sure you want to delete the user " + username + "?")){
                delUser(e.target.getAttribute('username'));
            }
        })
        div = document.createElement('div');
        div.appendChild(label);
        div.appendChild(divider);
        div.appendChild(deletebutton);
        userlist.appendChild(div);
    }
</script>
{% endif %}
{% endblock %}